function _isFractionalRating(rating){return Math.abs(rating-Math.floor(rating))>0}function _isMethod(nameofMethod){return"function"==typeof nameofMethod}function _checkSize(size,str){str=str?"of "+str:"";let value=+(size+"").replace(/px/g,"");return value?{value:value,unit:""}:(size&&console.error("improper size "+str),{value:null,unit:""})}function _validateColor(color){if(!color)return!1;if("number"==typeof color)return console.error("Incorrect color specified"),!1;if(color.startsWith("#")){if(!color.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/g))return console.error("Incorrect hex color code"),!1}else if(color.startsWith("rgb(")&&!color.replace(/\s/g,"").match(/^rgb\((\d+),(\d+),(\d+)\)$/g))return console.error("Incorrect rgb color code"),!1;return color}class SVGElement{constructor(tag){this._elem=document.createElementNS("http://www.w3.org/2000/svg",tag),this.attrs={}}getDomsvg(){return this._elem}removeDomsvg(){this._elem.parentNode.removeChild(this._elem)}appendChild(child){child instanceof Node?this._elem.appendChild(child):child instanceof SVGElement?this._elem.appendChild(child.getDomsvg()):console.error("Child must be Node or SVGElement")}removeChild(child){child instanceof Node?this._elem.removeChild(child):child instanceof SVGElement?this._elem.removeChild(child.getDomsvg()):console.error("Child must be Node or SVGElement")}setAttributes(attrs){let hasChange=!1;for(let attrName in attrs)this.attrs[attrName]!==attrs[attrName]&&(this._elem.setAttribute(attrName,attrs[attrName]),this.attrs[attrName]=attrs[attrName],hasChange=!0);return hasChange}}class SVGContainer extends SVGElement{constructor(container,height,width){super("svg"),this.getDomsvg().setAttribute("xmlns","https://www.w3.org/2000/svg"),container.appendChild(this.getDomsvg()),this.setAttributes({height:height,width:width}),[height,width]=this.getSize(),this.height=height,this.width=width}getSize(){let rect=this.getDomsvg().getBoundingClientRect();return[rect.height,rect.width]}getDefinition(){return this._def}addDefinition(def){def instanceof Definition&&(this.appendChild(def.defs),this._def=def)}update(height,width){return this.setAttributes({height:height,width:width})&&(this.height=height,this.width=width),[this.height,this.width]}}class Definition{constructor(svg){this.defs=new SVGElement("defs"),this.linearGradient=new SVGElement("linearGradient"),this.strokeLinearGradient=new SVGElement("linearGradient"),this.Rated=new SVGElement("stop"),this.NonRated=new SVGElement("stop"),this.strokeRated=new SVGElement("stop"),this.strokeNonRated=new SVGElement("stop"),this.linearGradient.appendChild(this.Rated),this.linearGradient.appendChild(this.NonRated),this.strokeLinearGradient.appendChild(this.strokeRated),this.strokeLinearGradient.appendChild(this.strokeNonRated),this.defs.appendChild(this.linearGradient),this.defs.appendChild(this.strokeLinearGradient),this._config={},svg.addDefinition(this)}update(rating,ratedFill,nonratedFill,ratedStroke,nonratedStroke,direction,flow){let ratingFraction=(rating-Math.floor(rating)).toFixed(2),_configsLG={x2:"row"==direction?"100%":"0%",y2:"column"==direction?"100%":"0%"};ratingFraction===this._config.ratingFraction&&this._config.ratedFill===ratedFill&&this._config.nonratedFill===nonratedFill&&this._config.ratedStroke===ratedStroke&&this._config.direction===direction&&this._config.flow===flow||(this._config.ratingFraction=ratingFraction,this._config.ratedFill=ratedFill,this._config.nonratedFill=nonratedFill,this._config.ratedStroke=ratedStroke,this._config.direction=direction,this._config.flow=flow,this.linearGradient.setAttributes({id:"partial-fill",..._configsLG}),this.strokeLinearGradient.setAttributes({id:"partial-stroke",..._configsLG}),"reverse"==flow&&([ratedFill,nonratedFill]=[nonratedFill,ratedFill],[ratedStroke,nonratedStroke]=[nonratedStroke,ratedStroke]),this.Rated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+ratedFill+";stop-opacity:1;"}),this.NonRated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+nonratedFill+";stop-opacity:1;"}),this.strokeRated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+ratedStroke+";stop-opacity:1;"}),this.strokeNonRated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+nonratedStroke+";stop-opacity:1;"}))}}class Rating{constructor(container,attribs){if(!(container instanceof HTMLElement))return console.error(" Where to draw the class ...no html container found"),null;if(this._elem={},this._config={},this._internalConfig={},this._onDraw={},this._internalConfig.firstDraw=!0,this._elem.container=container,this._config.height=400,this._config.width=400,this._config.NofStars=5,this._config.rating=void 0,this._config.orientation="left-to-right",this._config.padding=1,this._config.justifyContent="start",this._config.alignItems="center",this._config.strokeWidth=0,this._config.ratedFill="#00f",this._config.nonratedFill="#00ffff",this._config.ratedStroke="none",this._config.nonratedStroke="none",this._internalConfig.direction="row",this._internalConfig.startX=0,this._internalConfig.startY=0,this._internalConfig.xShift=0,this._internalConfig.yShift=0,this._internalConfig.flow="",this._elem.svg=new SVGContainer(container,this._config.height,this._config.width),this._elem.stars=[],attribs){if(!this._validateSet(attribs))return this._elem.svg.removeDomsvg(),console.error("Stopping execution"),null;this._calculateSide(this._config.padding,this._config.strokeWidth),this._internalConfig.requestedAnimationFrame=!0,window.requestAnimationFrame(()=>{this._draw()})}else this._calculateSide(this._config.padding,this._config.strokeWidth),this._internalConfig.requestedAnimationFrame=!0,window.requestAnimationFrame(()=>{this._draw()})}_calculateSide(padding,strokeWidth){let side,initialSide;if(initialSide="row"===this._internalConfig.direction?this._config.width/this._config.NofStars:this._config.width,initialSide=(side="column"===this._internalConfig.direction?this._config.height/this._config.NofStars:this._config.height)<initialSide?side:initialSide,void 0!==strokeWidth&&(strokeWidth<0||strokeWidth>.1*initialSide?console.error("Incorrect strokeWidth setting to default"):this._config.strokeWidth=strokeWidth),void 0!==padding&&(padding<1||padding>.1*initialSide?console.error("Incorrect padding setting to default"):this._config.padding=1),(side=initialSide-2*this._config.padding-2*this._config.strokeWidth)<10)return!1;side===this._internalConfig.side&&initialSide===this._internalConfig.initialSide||(this._internalConfig.side=side,this._internalConfig.initialSide=initialSide)}_validateSet(attribs){let currentVal,calcSide,strokeWidth,padding;return void 0!==attribs.orientation&&["left-to-right","right-to-left","top-to-bottom","bottom-to-top"].includes(attribs.orientation)&&currentVal!==this._config.orientation&&(this._config.orientation=attribs.orientation,attribs.direction="top-to-bottom"===attribs.orientation||"bottom-to-top"===attribs.orientation?"column":"row",this._internalConfig.direction!==attribs.direction&&(this._internalConfig.direction=attribs.direction,calcSide=!0),this._internalConfig.flow="left-to-right"===attribs.orientation||"top-to-bottom"===attribs.orientation?"":"reverse"),void 0!==attribs.height&&(currentVal=_checkSize(attribs.height)).value&&currentVal.value>=20&&currentVal.value!==this._config.height&&(this._config.height=currentVal.value,calcSide=!0),void 0!==attribs.width&&(currentVal=_checkSize(attribs.width)).value&&currentVal.value>=20&&currentVal.value!==this._config.width&&(this._config.width=currentVal.value,calcSide=!0),void 0!==attribs.stars&&((currentVal=+attribs.stars)>0&&currentVal!==this._config.NofStars?(this._config.NofStars=currentVal,calcSide=!0):currentVal||console.error("Incorrect value for stars: "+attribs.stars)),void 0!==attribs.padding&&(currentVal=_checkSize(attribs.padding)).value&&currentVal.value!==this._config.padding&&(padding=currentVal.value),void 0!==attribs.strokeWidth&&(currentVal=_checkSize(attribs.strokeWidth)).value&&currentVal.value!==this._config.strokeWidth&&(strokeWidth=currentVal.value),void 0!==attribs.rating&&((currentVal=+attribs.rating)>=0&&currentVal<=this._config.NofStars&&currentVal!==this._config.rating?this._config.rating=currentVal:currentVal||console.error("Incorrect rating value: "+attribs.rating)),null!=attribs.justifyContent&&["start","end","center","space-evenly"].includes(attribs.justifyContent)&&attribs.justifyContent!==this._config.justifyContent&&(this._config.justifyContent=attribs.justifyContent),null!=attribs.alignItems&&["start","end","center"].includes(attribs.alignItems)&&attribs.alignItems!==this._config.alignItems&&(this._config.alignItems=attribs.alignItems),void 0!==attribs.ratedFill&&((currentVal=_validateColor(attribs.ratedFill))&&currentVal!==this._config.ratedFill?this._config.ratedFill=currentVal:currentVal||console.error("Incorrect color for ratedFill: "+attribs.ratedFill)),void 0!==attribs.nonratedFill&&((currentVal=_validateColor(attribs.nonratedFill))&&currentVal!==this._config.nonratedFill?this._config.nonratedFill=currentVal:currentVal||console.error("Incorrect color for ratedFill: "+attribs.nonratedFill)),void 0!==attribs.ratedStroke&&((currentVal=_validateColor(attribs.ratedStroke))&&currentVal!==this._config.ratedStroke?this._config.ratedStroke=currentVal:currentVal||console.error("Incorrect color for ratedFill: "+attribs.ratedStroke)),void 0!==attribs.nonratedStroke&&((currentVal=_validateColor(attribs.nonratedStroke))&&currentVal!==this._config.nonratedStroke?this._config.nonratedStroke=currentVal:currentVal||console.error("Incorrect color for ratedFill: "+attribs.nonratedStroke)),calcSide&&this._calculateSide(padding,strokeWidth),!0}_orientationShiftsCalculation(){let xShift=0,yShift=0,startX=0,startY=0,justifyContent=this._config.justifyContent,alignItems=this._config.alignItems,side=this._internalConfig.side,initialSide=this._internalConfig.initialSide,height=this._config.height,width=this._config.width,NofStars=this._config.NofStars;"row"==this._internalConfig.direction?(xShift=initialSide,"start"==justifyContent?startX=initialSide/2:"center"==justifyContent?startX=initialSide/2+(width-initialSide*NofStars)/2:"end"==justifyContent?startX=width-initialSide*NofStars+initialSide/2:"space-evenly"==justifyContent&&(startX=(xShift=width/NofStars)/2),"center"==alignItems?startY=(initialSide-side)/2+(height-initialSide)/2:"start"==alignItems?startY=(initialSide-side)/2:"end"==alignItems&&(startY=height-initialSide)):"column"==this._internalConfig.direction&&(yShift=initialSide,"start"==justifyContent?startY=(initialSide-side)/2:"center"==justifyContent?startY=(initialSide-side)/2:"end"==justifyContent?startY=height-initialSide*NofStars:"space-evenly"==justifyContent&&(startY=((yShift=height/NofStars)-side)/2),"center"==alignItems?startX=initialSide/2+(width-initialSide)/2:"start"==alignItems?startX=initialSide/2:"end"==alignItems&&(startX=width-initialSide/2)),this._internalConfig.startX!==startX&&(this._internalConfig.startX=startX),this._internalConfig.startY!==startY&&(this._internalConfig.startY=startY),this._internalConfig.xShift!==xShift&&(this._internalConfig.xShift=xShift),this._internalConfig.yShift!==yShift&&(this._internalConfig.yShift=yShift),this._onDraw._reassignPath=!0}_getPath(side){let str="",cx=.3,ex=.3;return ex*=.5,str+="l"+.15*side+","+.3*side+" h"+.35*side+" l-"+(cx=.5*(.7-.3))*side+","+.3*side+" l"+cx*side+","+(.7-.3)*side+" l-"+.5*side+",-"+.25*side+" l-"+.5*side+","+.25*side+" l"+cx*side+",-"+(.7-.3)*side+" l-"+cx*side+",-"+.3*side+" h"+.35*side+" z"}_draw(){this._internalConfig.requestedAnimationFrame=!1,_isMethod(this.onPreDraw)?this.onPreDraw():this.onDraw&&console.error("onDraw must be a function");let i,j,rating=this._config.rating||0==this._config.rating?this._config.rating:this._config.NofStars,currentStars=this._elem.stars.length;this._internalConfig.relativePath=this._getPath(this._internalConfig.side),this._elem.svg.update(this._config.height,this._config.width);let defs=this._elem.svg.getDefinition();for(_isFractionalRating(rating)&&(defs||(defs=new Definition(this._elem.svg)),defs.update(rating,this._config.ratedFill,this._config.nonratedFill,this._config.ratedStroke,this._config.nonratedStroke,this._internalConfig.direction,this._internalConfig.flow)),this._orientationShiftsCalculation(),i=0;i<Math.max(this._config.NofStars,currentStars);i++){if(j="reverse"==this._internalConfig.flow?this._config.NofStars-i-1:i,i>=currentStars){let star=new SVGElement("path");this._elem.stars.push(star),this._elem.svg.appendChild(star)}else i>=this._config.NofStars&&this._elem.stars.pop().removeDomsvg();i<this._config.NofStars&&(_isFractionalRating(rating)&&Math.ceil(rating)==j+1?this._elem.stars[i].setAttributes({fill:"url(#partial-fill)",stroke:"url(#partial-stroke)","stroke-width":this._config.strokeWidth+"px",d:"M"+(this._internalConfig.startX+this._internalConfig.xShift*i)+","+(this._internalConfig.startY+this._internalConfig.yShift*i)+" "+this._internalConfig.relativePath}):this._elem.stars[i].setAttributes({fill:j<Math.ceil(rating)?this._config.ratedFill:this._config.nonratedFill,stroke:j<Math.ceil(rating)?this._config.ratedStroke:this._config.nonratedStroke,"stroke-width":this._config.strokeWidth+"px",d:"M"+(this._internalConfig.startX+this._internalConfig.xShift*i)+","+(this._internalConfig.startY+this._internalConfig.yShift*i)+" "+this._internalConfig.relativePath}))}_isMethod(this.onDraw)&&this.onDraw(),this._internalConfig.firstDraw=!1}update(attribs){if(attribs){if(!this._validateSet(attribs))return console.error("Stopping execution"),null;this._internalConfig.requestedAnimationFrame||(window.requestAnimationFrame(()=>{this._draw()}),this._internalConfig.requestedAnimationFrame=!0)}_isMethod(this.onUpdate)&&this.onUpdate(this._config)}}